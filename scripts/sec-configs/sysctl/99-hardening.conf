# ==============================
# Kernel hardening
# ==============================

# Restrict kernel pointer exposure
kernel.kptr_restrict = 2

# Restrict dmesg to privileged users
kernel.dmesg_restrict = 1

# Restrict perf events (information leak mitigation)
kernel.perf_event_paranoid = 3

# ==============================
# Kernel hardening (extended)
# ==============================

# Disable magic SysRq key
kernel.sysrq = 0

# Use PID in core dump filenames
kernel.core_uses_pid = 1

# Disable loading of kernel modules (FINAL STEP ONLY)
# kernel.modules_disabled = 1

# Disable unprivileged BPF
kernel.unprivileged_bpf_disabled = 1

# Disable TTY line discipline autoload
dev.tty.ldisc_autoload = 0

# Harden BPF JIT
net.core.bpf_jit_harden = 2



# ==============================
# Network hardening
# ==============================

# Reverse path filtering (anti-spoofing)
net.ipv4.conf.all.rp_filter = 1
net.ipv4.conf.default.rp_filter = 1

# Disable ICMP redirects
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv4.tcp_timestamps = 0

# Disable source routing
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.default.accept_source_route = 0

# Log suspicious packets
net.ipv4.conf.all.log_martians = 1
net.ipv4.conf.default.log_martians = 1

# Disable sending ICMP redirects
net.ipv4.conf.all.send_redirects = 0


net.ipv6.conf.all.accept_redirects = 0
net.ipv6.conf.default.accept_redirects = 0
net.ipv6.conf.all.accept_source_route = 0
net.ipv6.conf.default.accept_source_route = 0



fs.protected_fifos = 2

# ==============================
# FINAL LOCKDOWN (enable last)
# ==============================
# kernel.modules_disabled = 1

